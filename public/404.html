<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Easy To-Do - Redirecting...</title>
    <script type="text/javascript">
      // GitHub Pages SPA 라우팅을 위한 리다이렉트 (향상된 버전)
      (function () {
        var l = window.location;
        var ghPagesAppName = "easy-to-do"; // GitHub Pages 리포지토리 이름 또는 서브패스
        var baseUrl = "/" + ghPagesAppName + "/";

        console.log("404.html - Current location:", l.href);
        console.log("404.html - Original Pathname:", l.pathname);

        // 사용자가 접근하려던 전체 경로 (예: /easy-to-do/login?param=1)
        var intendedPathAndQuery = l.pathname + l.search;
        var intendedHash = l.hash;

        // 만약 경로가 이미 올바른 baseUrl로 시작하지 않는다면 (예: 커스텀 도메인 루트에서 직접 접근 시도)
        // 그리고 l.pathname이 단순히 ghPagesAppName으로만 구성된 경우 (예: /easy-to-do) 실제로는 /easy-to-do/를 의도한 것일 수 있음
        if (!intendedPathAndQuery.startsWith(baseUrl)) {
          if (l.pathname === "/" + ghPagesAppName) {
            intendedPathAndQuery = baseUrl + l.search; // /easy-to-do/ + query
          } else if (l.pathname.startsWith("/")) {
            // 의도된 경로를 baseUrl 뒤에 붙임 (예: /login -> /easy-to-do/login)
            intendedPathAndQuery =
              baseUrl +
              (intendedPathAndQuery.startsWith("/")
                ? intendedPathAndQuery.substring(1)
                : intendedPathAndQuery);
          } else {
            intendedPathAndQuery = baseUrl + intendedPathAndQuery;
          }
        }

        console.log(
          "404.html - Storing intended path+query:",
          intendedPathAndQuery
        );
        console.log("404.html - Storing intended hash:", intendedHash);

        try {
          // 전체 경로(쿼리 포함)와 해시를 분리하여 저장
          sessionStorage.setItem("redirect-path-query", intendedPathAndQuery);
          sessionStorage.setItem("redirect-hash", intendedHash);
        } catch (e) {
          console.warn("404.html - SessionStorage not available:", e);
          // SessionStorage를 사용할 수 없는 경우, 경로 정보를 URL 파라미터로 전달하는 등의 fallback 고려 가능
        }

        // SPA의 루트로 리디렉션 (예: https://username.github.io/easy-to-do/)
        // 이렇게 하면 index.html이 로드되고, 클라이언트 사이드 라우터가 sessionStorage의 경로를 사용함
        var spaRootUrl =
          l.protocol +
          "//" +
          l.hostname +
          (l.port ? ":" + l.port : "") +
          baseUrl;

        console.log("404.html - Redirecting to SPA root:", spaRootUrl);
        window.location.replace(spaRootUrl);
      })();
    </script>
  </head>
  <body>
    <div
      style="
        font-family: Arial, sans-serif;
        text-align: center;
        margin-top: 50px;
      "
    >
      <h2>Redirecting...</h2>
      <p>페이지를 찾고 있습니다. 잠시만 기다려주세요.</p>
    </div>
  </body>
</html>
